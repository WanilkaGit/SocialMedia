<!DOCTYPE html>
<html lang="ua">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}–ø–æ—Ä—Ç–∞–ª –≥—Ä—É–ø–ø–∏{% endblock %}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div class="top-panel">
        <!-- –õ–µ–≤–∞—è —Å–µ–∫—Ü–∏—è -->
        <div class="left-section">
            <a href="{% url 'index' %}">
                <button class="panel-button"><b>–ì–æ–ª–æ–≤–Ω–∞</b></button>
            </a>
        </div>
    
        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è -->
        <div class="center-section">
            <a href="{% url 'forum' %}">
                <button class="panel-button"><b>–§–æ—Ä—É–º</b></button>
            </a>
            <a href="{% url 'events-list' %}">
                <button class="panel-button"><b>–ü–æ–¥—ñ—ó</b></button>
            </a>
            <div class="dropdown">
                <input type="checkbox" id="toggle" class="dropdown-toggle">
                <label for="toggle" class="panel-button dropdown-label">
                    <b>–Ü–Ω—à–µ</b>
                    <span class="arrow">‚ñº</span>
                </label>
                <div class="dropdown-menu">
                    <a href="{% url 'daily' %}"><button class="small-button">–©–æ–¥–µ–Ω–Ω–∏–∫</button></a>
                    <a href="{% url 'gallery' %}"><button class="small-button">–ì–∞–ª–µ—Ä–µ—è</button></a>
                    <button class="small-button">–ö–Ω–æ–ø–∫–∞</button>
                </div>
            </div>
        </div>
    
        <!-- –ü—Ä–∞–≤–∞—è —Å–µ–∫—Ü–∏—è -->
        <div class="right-section">
            {% if not request.user.is_authenticated %}
                <a href="{% url 'login' %}" class="login-button"><b>–í—Ö—ñ–¥</b></a>
                <a href="{% url 'register' %}" class="register-button"><b>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</b></a>
            {% else %}
                <div class="profile-dropdown">
                    <div class="user-field dropdown-toggle">
                        <img src="{{ request.user.avatar.url }}" alt="avatar" class="avatar">
                        <div class="user-name">{{ request.user.username }}</div>
                    </div>
                    <div class="profile-dropdown-menu">
                        <a href="{% url 'profile' request.user.username %}" class="dropdown-item">
                            <img src="{{ request.user.avatar.url }}" alt="avatar" class="small-avatar">
                            –ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å
                        </a>
                        <a href="{% url 'view-history' %}" class="dropdown-item">
                            <i class="history-icon">üîç</i>
                            –Ü—Å—Ç–æ—Ä—ñ—è –ø–µ—Ä–µ–≥–ª—è–¥—ñ–≤
                        </a>
                        <div class="dropdown-divider"></div>
                        
                        <!-- –®–≤–∏–¥–∫—ñ –∞–∫–∞—É–Ω—Ç–∏ -->
                        <div class="quick-accounts">
                            <div class="quick-accounts-header">–ó–±–µ—Ä–µ–∂–µ–Ω—ñ –∞–∫–∞—É–Ω—Ç–∏</div>
                            {% for account in saved_accounts %}
                                <div class="dropdown-item account-item" onclick="switchAccount('{{ account.username }}')">
                                    <img src="{{ account.avatar.url }}" alt="avatar" class="small-avatar">
                                    {{ account.username }}
                                </div>
                            {% endfor %}
                            <button onclick="showAddAccountModal()" class="add-account-btn">
                                + –î–æ–¥–∞—Ç–∏ –∞–∫–∞—É–Ω—Ç
                            </button>
                        </div>
                        
                        <div class="dropdown-divider"></div>
                        <a href="javascript:void(0)" onclick="handleLogout()" class="dropdown-item logout-item">
                            <i class="logout-icon">‚Ü™</i>
                            –í–∏–π—Ç–∏
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    {% block content %}
    {% endblock %}

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∞–∫–∞—É–Ω—Ç—É -->
    <div id="addAccountModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–î–æ–¥–∞—Ç–∏ –∞–∫–∞—É–Ω—Ç –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É</h2>
            <form id="addAccountForm">
                <input type="text" placeholder="–õ–æ–≥—ñ–Ω" id="accountUsername" required>
                <input type="password" placeholder="–ü–∞—Ä–æ–ª—å" id="accountPassword" required>
                <button type="submit">–î–æ–¥–∞—Ç–∏</button>
            </form>
        </div>
    </div>

    <script>
        function showAddAccountModal() {
            const modal = document.getElementById('addAccountModal');
            modal.style.display = 'block';
        }

        // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –ø—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ —Ö—Ä–µ—Å—Ç–∏–∫
        document.querySelector('.close').onclick = function() {
            document.getElementById('addAccountModal').style.display = 'none';
        }

        // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
        window.onclick = function(event) {
            const modal = document.getElementById('addAccountModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // –û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ä–º–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∞–∫–∞—É–Ω—Ç—É
        document.getElementById('addAccountForm').onsubmit = function(e) {
            e.preventDefault();
            const username = document.getElementById('accountUsername').value;
            const password = document.getElementById('accountPassword').value;
            
            fetch('/auth/add-saved-account/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ 
                    username: username,
                    password: password
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    location.reload();
                } else {
                    alert(data.message);
                }
            });
        }

        function switchAccount(username) {
            fetch(`/auth/switch-account/${username}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    location.reload();
                } else {
                    alert(data.message);
                }
            });
        }

        function handleLogout() {
            fetch('/auth/logout/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url;
                } else {
                    window.location.href = '/';
                }
            });
        }
    </script>
</body>
</html>
